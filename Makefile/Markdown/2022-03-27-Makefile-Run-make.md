# Makefile 的执行

## 基本内容

在一个完整的 **Makefile** 中，包含了5个东西：**显式规则**，**隐含规则**，**变量**，**指示符** 和 **注释**。

 - **显式规则**：在 **Makefile** 中明确列出的规则，包含 **目标文件**，**依赖文件** 和 **命令**。

 - **隐含规则**：**Makefile** 根据 **目标文件** 而自动推导出来的规则。

 - **变量**：使用一个字符或字符串代表一段文本串，

 - **指示符**：指明在 **Makefile** 的解析过程中，所要执行的动作。

 - **注释**：**\#** 字符后的内容被作为是注释内容处理。

## 执行的文件名

 1. 按照文件名顺序寻找：**GNUmakefile**，**makefile**，**Makefile**。

 2. 通过命令行使用 **隐含规则** 自动生成目标文件。

 3. 使用 **-f** 或者 **–-file** 选项指定文件名。

## 包含其它文件

**include** 指示符告诉 **Makefile** 暂停读取当前的文件，而转去读取 **include** 指定的一个或者多个文件，完成以后再继续当前文件的读取。

如果指示符 **include** 指定的文件是 **相对路径**，则根据文件名在以下目录中查找：

 1. 当前目录。

 2. 查找使用命令行选项 **-I** 或者 **--include-dir** 指定的目录。

 3. 搜索默认目录 **/usr/gnu/include**，**/usr/local/include**，**/usr/include**。

 4. 继续处理 **Makefile** 的后续内容，并尝试使用规则创建 **include** 指定的但未找到的文件。

可使用 **-include** 或 **sinclude** 忽略由于包含文件不存在或者无法创建时的错误提示。

## 执行过程

 1. 依次读取变量 **MAKEFILES** 定义的文件列表。

 2. 读取并解析 **Makefile** 文件。

 3. 依次读取使用指示符 **include** 包含的文件。

 4. 查找所有已读取的 **Makefile** 文件的规则，如果存在一个目标是当前读取的某一个 **Makefile** 文件，则根据规则的命令重建此文件，并从第一步开始 **重新执行**。

 5. 初始化变量值并展开那些需要 **立即展开** 的变量和函数，并根据预设条件确定执行分支。

 6. 根据 **终极目标** 以及 **依赖关系** 建立 **依赖关系链**。

 7. 根据 **依赖关系链**，执行除 **终极目标** 以外的所有 **依赖目标** 的规则。

 8. 执行 **终极目标** 所在的规则。
